# 项目打包部署文档

本文档详细说明如何在 Windows 和 Ubuntu 系统下将本项目打包为安装包。

## 前置条件

本项目基于 Tauri 2.0 + Vue 3 + Vite 开发。在开始打包之前，请确保开发环境已安装以下基础工具：

1.  **Node.js**: 建议版本 v18+
2.  **Package Manager**: 本项目使用 `pnpm`
3.  **Rust**: 需要安装 Rust 编程语言环境 (建议使用 rustup)

---

## Windows 环境打包

### 1. 环境准备

在 Windows 上构建 Tauri 应用需要安装 Microsoft Visual Studio C++ 生成工具。

1.  下载并安装 [Build Tools for Visual Studio 2022](https://visualstudio.microsoft.com/visual-cpp-build-tools/)。
2.  在安装过程中，勾选 **"C++ 桌面开发" (Desktop development with C++)** 工作负载。
3.  确保安装了 Rust：
    访问 [https://rustup.rs/](https://rustup.rs/) 下载 `rustup-init.exe` 并运行。

### 2. 执行打包

在项目根目录下打开终端（PowerShell 或 CMD），执行以下命令：

```bash
# 1. 安装项目依赖（如果尚未安装）
pnpm install

# 2. 执行构建命令
pnpm tauri build
```

### 3. 输出产物

打包成功后，安装包将生成在以下目录：

-   `.msi` 安装包: `src-tauri/target/release/bundle/msi/`
-   `.exe` 安装包: `src-tauri/target/release/bundle/nsis/` (如果配置了 NSIS)

通常你会找到一个后缀为 `.msi` 或 `.exe` 的安装文件，这就是 Windows 下的最终安装包。

---

## Ubuntu (Linux) 环境打包

### 1. 环境准备

在 Ubuntu 上构建需要安装一些系统依赖库。

1.  更新 apt 源并安装依赖：

```bash
sudo apt update
sudo apt install libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    file \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev
```

> 注意：如果是 Ubuntu 22.04 或更高版本，可能需要使用 `libwebkit2gtk-4.1-dev` 替代 `libwebkit2gtk-4.0-dev`。

2.  确保安装了 Rust：
    ```bash
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    ```

### 2. 配置打包格式（可选）

默认情况下，Tauri 在 Linux 上会生成 `.deb` 和 `.AppImage`。如果你只需要特定的格式（例如只想要 `.deb` 或 `.rpm`），请修改 `src-tauri/tauri.conf.json` 文件中的 `bundle` -> `targets` 配置。

**只生成 deb 包：**

```json
// src-tauri/tauri.conf.json
{
  "bundle": {
    "active": true,
    "targets": ["deb"], 
    // ... 其他配置
  }
}
```

**只生成 rpm 包：**

> 注意：生成 rpm 包需要在 Ubuntu 上安装 rpm 工具：`sudo apt install rpm`

```json
// src-tauri/tauri.conf.json
{
  "bundle": {
    "active": true,
    "targets": ["rpm"],
    // ... 其他配置
  }
}
```

### 3. 执行打包

在项目根目录下打开终端，执行以下命令：

```bash
# 1. 安装项目依赖
pnpm install

# 2. 执行构建命令
pnpm tauri build
```

### 4. 输出产物

打包成功后，安装包将生成在以下目录：

-   `.deb` 安装包: `src-tauri/target/release/bundle/deb/`
-   `.rpm` 安装包: `src-tauri/target/release/bundle/rpm/`
-   `.AppImage` 文件: `src-tauri/target/release/bundle/appimage/`

根据你的配置，只会生成对应的文件。

---

## 常见问题与注意事项

1.  **跨平台构建限制**：
    Tauri 默认**不支持**在一个平台上直接构建另一个平台的安装包（例如不能在 Windows 上直接打出 Linux 的包，反之亦然）。
    -   **解决方案**：
        -   方法 A：分别在对应的操作系统上进行编译打包。
        -   方法 B：使用 GitHub Actions 等 CI/CD 工具进行自动化构建（推荐）。

2.  **构建失败排查**：
    -   如果遇到 Rust 相关的编译错误，尝试更新 Rust 版本：`rustup update`。
    -   如果遇到前端构建错误，先尝试运行 `pnpm build` 检查 Vue/TS 代码是否有误。
    -   检查 `src-tauri/tauri.conf.json` 中的 `identifier` 是否唯一，默认的 `com.tauri.dev` 在某些情况下可能需要修改。

3.  **图标配置**：
    打包时的应用图标位于 `src-tauri/icons/` 目录。如果需要修改图标，请替换该目录下的图片文件，并保持文件名和尺寸一致。可以使用 `pnpm tauri icon` 命令自动生成不同尺寸的图标。
